//assume I am on the same subnet as the device.
//activate
//cfx run -b "C:\program files\nightly\firefox.exe" 
//jpm run -b "C:\program files\nightly\firefox.exe" -p ExtensionDev --debug -v


var searcher;
/**
 * extension startup
 */
exports.main = function main() {
	const buttons = require('sdk/ui/button/toggle'); // https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/ui_button_toggle
	const notifications = require('sdk/notifications'); // https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/notifications
	const panels = require('sdk/panel'); // https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/panel
	const storage = require('sdk/simple-storage'); // https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/simple-storage
    const tabs = require("sdk/tabs");
    const timers = require('sdk/timers'); // https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/timers
    const { URL } = require('sdk/url'); // https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/url

    const { Factory } = require('./Factories/Factory');
	const { Searcher } = require('./Searcher');
    const { HTTPServer } = require("./Network/HTTPServer");
    const { FilePicker } = require("./FilePicker");
    const { Sender } = require("./SenderDaemon");

    var pageWorker;
    var sender;
    var factory = new Factory();
    var httpServer = factory.createHttpServer();
    httpServer.start(7895);
    
    var panel = panels.Panel({
         contentURL: './Panel/panel.html',
         contentScriptFile: ['./libs/angular.js', './Panel/rotary.js', './Panel/services/DeviceService.js', './Panel/controllers/DeviceController.js'],
         contentStyleFile: './Panel/panel.css',
         onHide: function(){
            button.state('window', {checked: false});
         }
	 });
	var button = buttons.ToggleButton({
		id: 'rotary',
		label: 'Rotary',
		icon: {
			16: './icons/rotary-16.png',
			32: './icons/rotary-32.png',
			64: './icons/rotary-64.png'
		},
		onChange: onButtonChange
	});
	function onButtonChange(state) {
		if (state.checked) {
            panel.show({position: button});
			if(!useTestDevices)searcher.search();
            //openFocusTab('./panel.html',['./libs/angular.js', './panel.js']);
		}
	}

    panel.show();
    panel.hide();
    
	searcher = factory.createSearcher();
	searcher.devices = useTestDevices ? testDevices : storage.devices || [];
    searcher.devices.forEach(device => panel.port.emit('deviceFound', device));
    
	if(!useTestDevices)searcher.search();

	searcher.on('deviceLost', (device) => {
		if (pageWorker) pageWorker.port.emit('deviceLost', device);
        panel.port.emit('deviceLost', device);
		storage.devices = searcher.devices;
	});
	searcher.on('deviceFound', (device, isNew) => {
		if(isNew)
            notifications.notify({
                title: 'Found ' + device.name,
                text: "a " + device.model.name + " by " + device.manufacturer.name,
                iconURL: device.icons.length > 0 && device.icons[0].url ? device.icons[0].url.href : ""
            });
		if (pageWorker) pageWorker.port.emit('deviceFound', device);
        panel.port.emit('deviceFound', device);
		storage.devices = searcher.devices;
	});
    
    panel.port.on('updateHeight', function (newHeight) {
        panel.height = newHeight;
    });
    panel.port.on('chooseFile', function(device, fileType){
        filePicker = factory.createFilePicker();
        var file = filePicker.openFile();
        var pickedFile = file ? {
                path: file.path,
                name: file.leafName
            } : null;
        panel.port.emit('pickedFile', device, pickedFile);
    });
    panel.port.on('launch', function(device){
        var filePath = "/" + device.file.name;
        var deviceIp = new URL(device.address).host;
        httpServer.registerFile(filePath, device.file.path);
        httpServer.registerDirectory("/VideoPlayer/","Y:\\Projects\\Github\\My Stuff\\Rotary\\data\\VideoPlayer\\");
        var serverIp = httpServer.getServerIp(deviceIp);
        sender= new Sender(deviceIp, serverIp);
        sender.launch("/VideoPlayer/Receiver/Receiver.html", filePath);
    });
    panel.port.on('sendCommand', function(command, device){
        sender.executeCommand(command);
    });    
    
	function openFocusTab(url, contentScriptFiles) {
		if (pageWorker) return pageWorker.tab.activate();

		tabs.open({
			url: url,
			onLoad: function(tab){
                pageWorker = tab.attach({
                    contentScriptFile: contentScriptFiles
                });
            },
			onClose: function (tab) {
				pageWorker = null;
			}
		});
	}
};
/**
 * extension shutdown
 */
exports.onUnload = function onUnload() {
	searcher.stopSearch();
};



var useTestDevices = false;
var testDevices = JSON.parse('[{"_emitter":{"EVENT_TYPE_PATTERN":{}},"rawResponse":{"specversion":{"major":1,"minor":0},"device":{"devicetype":"urn:schemas-upnp-org:device:MediaServer:1","friendlyname":"RT-AC66R-76E0","manufacturer":"ASUSTeK Computer Inc.","manufacturerurl":"http://www.asus.com/","modeldescription":"MiniDLNA on asuswrt","modelname":"Windows Media Connect compatible","modelnumber":"3.0.0.4.376","modelurl":"http://www.asus.com/","serialnumber":"e0:3f:49:9d:76:e0","udn":"uuid:4d696e69-444c-164e-9d41-c4544483e8d8","presentationurl":"http://192.168.1.1:80/","iconlist":{"icon":[{"mimetype":"image/png","width":48,"height":48,"depth":24,"url":"/icons/sm.png"},{"mimetype":"image/png","width":120,"height":120,"depth":24,"url":"/icons/lrg.png"},{"mimetype":"image/jpeg","width":48,"height":48,"depth":24,"url":"/icons/sm.jpg"},{"mimetype":"image/jpeg","width":120,"height":120,"depth":24,"url":"/icons/lrg.jpg"}]},"servicelist":{"service":[{"servicetype":"urn:schemas-upnp-org:service:ContentDirectory:1","serviceid":"urn:upnp-org:serviceId:ContentDirectory","controlurl":"/ctl/ContentDir","eventsuburl":"/evt/ContentDir","scpdurl":"/ContentDir.xml"},{"servicetype":"urn:schemas-upnp-org:service:ConnectionManager:1","serviceid":"urn:upnp-org:serviceId:ConnectionManager","controlurl":"/ctl/ConnectionMgr","eventsuburl":"/evt/ConnectionMgr","scpdurl":"/ConnectionMgr.xml"},{"servicetype":"urn:microsoft.com:service:X_MS_MediaReceiverRegistrar:1","serviceid":"urn:microsoft.com:serviceId:X_MS_MediaReceiverRegistrar","controlurl":"/ctl/X_MS_MediaReceiverRegistrar","eventsuburl":"/evt/X_MS_MediaReceiverRegistrar","scpdurl":"/X_MS_MediaReceiverRegistrar.xml"}]}},"@xmlns":"urn:schemas-upnp-org:device-1-0"},"address":"http://192.168.1.1:8200/","upnpVersion":"1.0","serialNumber":"e0:3f:49:9d:76:e0","webPage":"http://192.168.1.1:80/","type":{"urn":"urn:schemas-upnp-org:device:MediaServer:1","name":"Media Server 1"},"name":"RT-AC66R-76E0","manufacturer":{"name":"ASUSTeK Computer Inc.","url":"http://www.asus.com/"},"model":{"number":"3.0.0.4.376","description":"MiniDLNA on asuswrt","name":"Windows Media Connect compatible","url":"http://www.asus.com/","udn":"uuid:4d696e69-444c-164e-9d41-c4544483e8d8"},"icons":[{"mimeType":"image/png","width":48,"height":48,"depth":24,"url":"http://192.168.1.1:8200/icons/sm.png"},{"mimeType":"image/png","width":120,"height":120,"depth":24,"url":"http://192.168.1.1:8200/icons/lrg.png"},{"mimeType":"image/jpeg","width":48,"height":48,"depth":24,"url":"http://192.168.1.1:8200/icons/sm.jpg"},{"mimeType":"image/jpeg","width":120,"height":120,"depth":24,"url":"http://192.168.1.1:8200/icons/lrg.jpg"}],"services":[{"controlUrl":"http://192.168.1.1:8200/ctl/ContentDir","eventsSubUrl":null,"scpdUrl":"http://192.168.1.1:8200/ContentDir.xml","id":"urn:upnp-org:serviceId:ContentDirectory","type":{"urn":"urn:schemas-upnp-org:service:ContentDirectory:1","name":"Content Directory 1"}},{"controlUrl":"http://192.168.1.1:8200/ctl/ConnectionMgr","eventsSubUrl":null,"scpdUrl":"http://192.168.1.1:8200/ConnectionMgr.xml","id":"urn:upnp-org:serviceId:ConnectionManager","type":{"urn":"urn:schemas-upnp-org:service:ConnectionManager:1","name":"Connection Manager 1"}},{"controlUrl":"http://192.168.1.1:8200/ctl/X_MS_MediaReceiverRegistrar","eventsSubUrl":null,"scpdUrl":"http://192.168.1.1:8200/X_MS_MediaReceiverRegistrar.xml","id":"urn:microsoft.com:serviceId:X_MS_MediaReceiverRegistrar","type":{"urn":"urn:microsoft.com:service:X_MS_MediaReceiverRegistrar:1","name":"Media Receiver Registrar"}}]},{"_emitter":{"EVENT_TYPE_PATTERN":{}},"rawResponse":{"specversion":{"major":1,"minor":0},"device":{"devicetype":"urn:schemas-wifialliance-org:device:WFADevice:1","friendlyname":"ASUS WPS Router","manufacturer":"ASUSTeK Corporation","manufacturerurl":"http://www.asus.com","modeldescription":"ASUS WPS Router","modelname":"WPS Router","modelnumber":"X1","serialnumber":1,"udn":"uuid:de66ab88-4bf8-e494-5d03-1c515f227222","servicelist":{"service":{"servicetype":"urn:schemas-wifialliance-org:service:WFAWLANConfig:1","serviceid":"urn:wifialliance-org:serviceId:WFAWLANConfig1","scpdurl":"/x_wfawlanconfig.xml","controlurl":"/control?WFAWLANConfig","eventsuburl":"/event?WFAWLANConfig"}}},"@xmlns":"urn:schemas-upnp-org:device-1-0"},"address":"http://192.168.1.1:1990/","upnpVersion":"1.0","serialNumber":1,"type":{"urn":"urn:schemas-wifialliance-org:device:WFADevice:1","name":"WFA"},"name":"ASUS WPS Router","manufacturer":{"name":"ASUSTeK Corporation","url":"http://www.asus.com"},"model":{"number":"X1","description":"ASUS WPS Router","name":"WPS Router","udn":"uuid:de66ab88-4bf8-e494-5d03-1c515f227222"},"icons":[],"services":[{"controlUrl":"http://192.168.1.1:1990/control?WFAWLANConfig","eventsSubUrl":null,"scpdUrl":"http://192.168.1.1:1990/x_wfawlanconfig.xml","id":"urn:wifialliance-org:serviceId:WFAWLANConfig1","type":{"urn":"urn:schemas-wifialliance-org:service:WFAWLANConfig:1","name":"WFA WLAN Config"}}]},{"_emitter":{"EVENT_TYPE_PATTERN":{}},"rawResponse":{"specversion":{"major":1,"minor":0},"device":{"devicetype":"urn:schemas-upnp-org:device:InternetGatewayDevice:1","friendlyname":"RT-AC66R","manufacturer":"ASUSTeK Computer Inc.","manufacturerurl":"http://www.asus.com","modeldescription":"RT-AC66R","modelname":"RT-AC66R","modelnumber":"3.0.0.4.376","modelurl":"http://www.asus.com","serialnumber":"CAIAA2000001","udn":"uuid:4bc21797-47af-428a-bec7-cf3f0fc8452f","servicelist":{"service":{"servicetype":"urn:schemas-upnp-org:service:Layer3Forwarding:1","serviceid":"urn:upnp-org:serviceId:Layer3Forwarding1","controlurl":"/ctl/L3F","eventsuburl":"/evt/L3F","scpdurl":"/L3F.xml"}},"devicelist":{"device":{"devicetype":"urn:schemas-upnp-org:device:WANDevice:1","friendlyname":"WANDevice","manufacturer":"MiniUPnP","manufacturerurl":"http://miniupnp.free.fr/","modeldescription":"WAN Device","modelname":"WAN Device","modelnumber":1.4,"modelurl":"http://miniupnp.free.fr/","serialnumber":"CAIAA2000001","udn":"uuid:4bc21797-47af-428a-bec7-cf3f0fc8452f","upc":"MINIUPNPD","servicelist":{"service":{"servicetype":"urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1","serviceid":"urn:upnp-org:serviceId:WANCommonIFC1","controlurl":"/ctl/CmnIfCfg","eventsuburl":"/evt/CmnIfCfg","scpdurl":"/WANCfg.xml"}},"devicelist":{"device":{"devicetype":"urn:schemas-upnp-org:device:WANConnectionDevice:1","friendlyname":"WANConnectionDevice","manufacturer":"MiniUPnP","manufacturerurl":"http://miniupnp.free.fr/","modeldescription":"MiniUPnP daemon","modelname":"MiniUPnPd","modelnumber":1.4,"modelurl":"http://miniupnp.free.fr/","serialnumber":"CAIAA2000001","udn":"uuid:4bc21797-47af-428a-bec7-cf3f0fc8452f","upc":"MINIUPNPD","servicelist":{"service":{"servicetype":"urn:schemas-upnp-org:service:WANIPConnection:1","serviceid":"urn:upnp-org:serviceId:WANIPConn1","controlurl":"/ctl/IPConn","eventsuburl":"/evt/IPConn","scpdurl":"/WANIPCn.xml"}}}}}},"presentationurl":"http://192.168.1.1"},"@xmlns":"urn:schemas-upnp-org:device-1-0"},"address":"http://192.168.1.1:44417/","upnpVersion":"1.0","serialNumber":"CAIAA2000001","webPage":"http://192.168.1.1","type":{"urn":"urn:schemas-upnp-org:device:InternetGatewayDevice:1","name":"Internet Gateway 1"},"name":"RT-AC66R","manufacturer":{"name":"ASUSTeK Computer Inc.","url":"http://www.asus.com"},"model":{"number":"3.0.0.4.376","description":"RT-AC66R","name":"RT-AC66R","url":"http://www.asus.com","udn":"uuid:4bc21797-47af-428a-bec7-cf3f0fc8452f"},"icons":[],"services":[{"controlUrl":"http://192.168.1.1:44417/ctl/L3F","eventsSubUrl":null,"scpdUrl":"http://192.168.1.1:44417/L3F.xml","id":"urn:upnp-org:serviceId:Layer3Forwarding1","type":{"urn":"urn:schemas-upnp-org:service:Layer3Forwarding:1","name":"Layer 3 Forwarding"}}]},{"_emitter":{"EVENT_TYPE_PATTERN":{}},"rawResponse":{"specversion":{"major":1,"minor":0},"device":{"devicetype":"urn:schemas-upnp-org:device:MediaRenderer:1","friendlyname":"STR-DN1040","manufacturer":"Sony Corporation","manufacturerurl":"http://www.sony.net/","modeldescription":"MULTI CHANNEL AV RECEIVER","modelname":"STR-DN1040","modelnumber":"JB3.1.1","udn":"uuid:5f9ec1b3-ed59-1900-4530-d8d43caafb4f","iconlist":{"icon":[{"mimetype":"image/jpeg","width":48,"height":48,"depth":24,"url":"/device_icon_48.jpg"},{"mimetype":"image/jpeg","width":120,"height":120,"depth":24,"url":"/device_icon_120.jpg"},{"mimetype":"image/png","width":48,"height":48,"depth":24,"url":"/device_icon_48.png"},{"mimetype":"image/png","width":120,"height":120,"depth":24,"url":"/device_icon_120.png"}]},"servicelist":{"service":[{"servicetype":"urn:schemas-upnp-org:service:RenderingControl:1","serviceid":"urn:upnp-org:serviceId:RenderingControl","scpdurl":"/RenderingControl/desc.xml","controlurl":"/RenderingControl/ctrl","eventsuburl":"/RenderingControl/evt"},{"servicetype":"urn:schemas-upnp-org:service:ConnectionManager:1","serviceid":"urn:upnp-org:serviceId:ConnectionManager","scpdurl":"/ConnectionManager/desc.xml","controlurl":"/ConnectionManager/ctrl","eventsuburl":"/ConnectionManager/evt"},{"servicetype":"urn:schemas-upnp-org:service:AVTransport:1","serviceid":"urn:upnp-org:serviceId:AVTransport","scpdurl":"/AVTransport/desc.xml","controlurl":"/AVTransport/ctrl","eventsuburl":"/AVTransport/evt"},{"servicetype":"urn:schemas-sony-com:service:Party:1","serviceid":"urn:schemas-sony-com:serviceId:Party","scpdurl":"/Party_scpd.xml","controlurl":"/Party_Control","eventsuburl":"/Party_Event"},{"servicetype":"urn:schemas-sony-com:service:IRCC:1","serviceid":"urn:schemas-sony-com:serviceId:IRCC","scpdurl":"/IRCCSCPD.xml","controlurl":"/upnp/control/IRCC","eventsuburl":"/"}]},"devicelist":{"device":{"devicetype":"urn:schemas-upnp-org:device:Basic:1","friendlyname":"STR_CISIP","manufacturer":"Sony Corporation","manufacturerurl":"http://www.sony.net/","modeldescription":"IPSTR2","modelname":"STR-DN1040","modelnumber":true,"modelurl":"http://www.sony.net/","udn":"uuid:5f9ec1b3-ed59-1900-4531-d8d43caafb4f","servicelist":{"service":{"servicetype":"urn:schemas-sony-com:service:X_CIS:1","serviceid":"urn:schemas-sony-com:serviceId:X_CIS","scpdurl":"CIS_ServiceDescription.xml","controlurl":"/upnp/control/CIS","eventsuburl":"/upnp/event/CIS"}}}},"presentationurl":"http://192.168.1.14"},"@xmlns":"urn:schemas-upnp-org:device-1-0","@xmlns:pnpx":"http://schemas.microsoft.com/windows/pnpx/2005/11","@xmlns:df":"http://schemas.microsoft.com/windows/2008/09/devicefoundation"},"address":"http://192.168.1.14:8080/","upnpVersion":"1.0","webPage":"http://192.168.1.14","type":{"urn":"urn:schemas-upnp-org:device:MediaRenderer:1","name":"Media Renderer 1"},"name":"STR-DN1040","manufacturer":{"name":"Sony Corporation","url":"http://www.sony.net/"},"model":{"number":"JB3.1.1","description":"MULTI CHANNEL AV RECEIVER","name":"STR-DN1040","udn":"uuid:5f9ec1b3-ed59-1900-4530-d8d43caafb4f"},"icons":[{"mimeType":"image/jpeg","width":48,"height":48,"depth":24,"url":"http://192.168.1.14:8080/device_icon_48.jpg"},{"mimeType":"image/jpeg","width":120,"height":120,"depth":24,"url":"http://192.168.1.14:8080/device_icon_120.jpg"},{"mimeType":"image/png","width":48,"height":48,"depth":24,"url":"http://192.168.1.14:8080/device_icon_48.png"},{"mimeType":"image/png","width":120,"height":120,"depth":24,"url":"http://192.168.1.14:8080/device_icon_120.png"}],"services":[{"controlUrl":"http://192.168.1.14:8080/RenderingControl/ctrl","eventsSubUrl":null,"scpdUrl":"http://192.168.1.14:8080/RenderingControl/desc.xml","id":"urn:upnp-org:serviceId:RenderingControl","type":{"urn":"urn:schemas-upnp-org:service:RenderingControl:1","name":"Rendering Control"}},{"controlUrl":"http://192.168.1.14:8080/ConnectionManager/ctrl","eventsSubUrl":null,"scpdUrl":"http://192.168.1.14:8080/ConnectionManager/desc.xml","id":"urn:upnp-org:serviceId:ConnectionManager","type":{"urn":"urn:schemas-upnp-org:service:ConnectionManager:1","name":"Connection Manager 1"}},{"controlUrl":"http://192.168.1.14:8080/AVTransport/ctrl","eventsSubUrl":null,"scpdUrl":"http://192.168.1.14:8080/AVTransport/desc.xml","id":"urn:upnp-org:serviceId:AVTransport","type":{"urn":"urn:schemas-upnp-org:service:AVTransport:1","name":"AV Transport 1"}},{"controlUrl":"http://192.168.1.14:8080/Party_Control","eventsSubUrl":null,"scpdUrl":"http://192.168.1.14:8080/Party_scpd.xml","id":"urn:schemas-sony-com:serviceId:Party","type":{"urn":"urn:schemas-sony-com:service:Party:1","name":"Party"}},{"controlUrl":"http://192.168.1.14:8080/upnp/control/IRCC","eventsSubUrl":null,"scpdUrl":"http://192.168.1.14:8080/IRCCSCPD.xml","id":"urn:schemas-sony-com:serviceId:IRCC","type":{"urn":"urn:schemas-sony-com:service:IRCC:1","name":"IRCC"}}]},{"_emitter":{"EVENT_TYPE_PATTERN":{}},"rawResponse":{"specversion":{"major":1,"minor":0},"device":{"devicetype":"urn:schemas-upnp-org:device:MediaServer:1","friendlyname":"STR-DN1040","manufacturer":"Sony Corporation","manufacturerurl":"http://www.sony.net/","modeldescription":"MULTI CHANNEL AV RECEIVER","modelname":"STR-DN1040","udn":"uuid:5f9ec1b3-ed59-1900-4532-d8d43caafb4f","iconlist":{"icon":[{"mimetype":"image/jpeg","width":48,"height":48,"depth":24,"url":"/device_icon_48.jpg"},{"mimetype":"image/jpeg","width":120,"height":120,"depth":24,"url":"/device_icon_120.jpg"},{"mimetype":"image/png","width":48,"height":48,"depth":24,"url":"/device_icon_48.png"},{"mimetype":"image/png","width":120,"height":120,"depth":24,"url":"/device_icon_120.png"}]},"servicelist":{"service":[{"servicetype":"urn:schemas-upnp-org:service:ContentDirectory:1","serviceid":"urn:upnp-org:serviceId:ContentDirectory","scpdurl":"/ContentDirectory_desc.xml","controlurl":"/ContentDirectory_ctrl","eventsuburl":"/ContentDirectory_evt"},{"servicetype":"urn:schemas-upnp-org:service:ConnectionManager:1","serviceid":"urn:upnp-org:serviceId:ConnectionManager","scpdurl":"/ConnectionManager_desc.xml","controlurl":"/ConnectionManager_ctrl","eventsuburl":"/ConnectionManager_evt"}]},"presentationurl":"http://192.168.1.14"},"@xmlns":"urn:schemas-upnp-org:device-1-0"},"address":"http://192.168.1.14:8000/","upnpVersion":"1.0","webPage":"http://192.168.1.14","type":{"urn":"urn:schemas-upnp-org:device:MediaServer:1","name":"Media Server 1"},"name":"STR-DN1040","manufacturer":{"name":"Sony Corporation","url":"http://www.sony.net/"},"model":{"description":"MULTI CHANNEL AV RECEIVER","name":"STR-DN1040","udn":"uuid:5f9ec1b3-ed59-1900-4532-d8d43caafb4f"},"icons":[{"mimeType":"image/jpeg","width":48,"height":48,"depth":24,"url":"http://192.168.1.14:8000/device_icon_48.jpg"},{"mimeType":"image/jpeg","width":120,"height":120,"depth":24,"url":"http://192.168.1.14:8000/device_icon_120.jpg"},{"mimeType":"image/png","width":48,"height":48,"depth":24,"url":"http://192.168.1.14:8000/device_icon_48.png"},{"mimeType":"image/png","width":120,"height":120,"depth":24,"url":"http://192.168.1.14:8000/device_icon_120.png"}],"services":[{"controlUrl":"http://192.168.1.14:8000/ContentDirectory_ctrl","eventsSubUrl":null,"scpdUrl":"http://192.168.1.14:8000/ContentDirectory_desc.xml","id":"urn:upnp-org:serviceId:ContentDirectory","type":{"urn":"urn:schemas-upnp-org:service:ContentDirectory:1","name":"Content Directory 1"}},{"controlUrl":"http://192.168.1.14:8000/ConnectionManager_ctrl","eventsSubUrl":null,"scpdUrl":"http://192.168.1.14:8000/ConnectionManager_desc.xml","id":"urn:upnp-org:serviceId:ConnectionManager","type":{"urn":"urn:schemas-upnp-org:service:ConnectionManager:1","name":"Connection Manager 1"}}]},{"_emitter":{"EVENT_TYPE_PATTERN":{}},"rawResponse":{"specversion":{"major":1,"minor":0},"device":{"udn":"uuid:41cf7512-c290-4bff-82bf-962e4cab1c26","friendlyname":"TOSHIBA: PJ:","devicetype":"urn:schemas-upnp-org:device:MediaServer:1","manufacturer":"Microsoft Corporation","manufacturerurl":"http://www.microsoft.com","modelname":"Windows Media Player Sharing","modelnumber":12,"modelurl":"http://go.microsoft.com/fwlink/?LinkId=105926","serialnumber":"S-1-5-21-3493001740-195389577-1747714056-1001","iconlist":{"icon":[{"mimetype":"image/jpeg","width":120,"height":120,"depth":24,"url":"/upnphost/udhisapi.dll?content=uuid:6571a80c-b099-4ef1-bff1-f632e6d00a42"},{"mimetype":"image/png","width":120,"height":120,"depth":24,"url":"/upnphost/udhisapi.dll?content=uuid:0a332791-2b2f-4eb5-b2e4-484a067fe6ad"},{"mimetype":"image/jpeg","width":48,"height":48,"depth":24,"url":"/upnphost/udhisapi.dll?content=uuid:fe67aac6-d76b-4a9b-a80a-8a3a21a1df52"},{"mimetype":"image/png","width":48,"height":48,"depth":24,"url":"/upnphost/udhisapi.dll?content=uuid:52a7e157-ccae-4e53-afe9-296d070682aa"},{"mimetype":"image/bmp","width":48,"height":48,"depth":16,"url":"/upnphost/udhisapi.dll?content=uuid:ab2b28a7-b393-40c5-aa24-e90c30cd1e75"},{"mimetype":"image/jpeg","width":32,"height":32,"depth":24,"url":"/upnphost/udhisapi.dll?content=uuid:70695fe5-5ca5-4caa-aa5c-8e8dd95979d4"},{"mimetype":"image/bmp","width":32,"height":32,"depth":16,"url":"/upnphost/udhisapi.dll?content=uuid:ba118676-7928-45aa-abf4-75cd2a0d9540"}]},"servicelist":{"service":[{"servicetype":"urn:schemas-upnp-org:service:ConnectionManager:1","serviceid":"urn:upnp-org:serviceId:ConnectionManager","controlurl":"/upnphost/udhisapi.dll?control=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:upnp-org:serviceId:ConnectionManager","eventsuburl":"/upnphost/udhisapi.dll?event=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:upnp-org:serviceId:ConnectionManager","scpdurl":"/upnphost/udhisapi.dll?content=uuid:ea27425e-13a7-4c9e-ab1a-70228afb3dee"},{"servicetype":"urn:schemas-upnp-org:service:ContentDirectory:1","serviceid":"urn:upnp-org:serviceId:ContentDirectory","controlurl":"/upnphost/udhisapi.dll?control=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:upnp-org:serviceId:ContentDirectory","eventsuburl":"/upnphost/udhisapi.dll?event=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:upnp-org:serviceId:ContentDirectory","scpdurl":"/upnphost/udhisapi.dll?content=uuid:51077243-1d70-4741-8a2e-8d9056ae7d59"},{"servicetype":"urn:microsoft.com:service:X_MS_MediaReceiverRegistrar:1","serviceid":"urn:microsoft.com:serviceId:X_MS_MediaReceiverRegistrar","controlurl":"/upnphost/udhisapi.dll?control=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:microsoft.com:serviceId:X_MS_MediaReceiverRegistrar","eventsuburl":"/upnphost/udhisapi.dll?event=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:microsoft.com:serviceId:X_MS_MediaReceiverRegistrar","scpdurl":"/upnphost/udhisapi.dll?content=uuid:f95ddc12-eb3f-4dfb-b5a1-a310ce477525"}]}},"@xmlns":"urn:schemas-upnp-org:device-1-0"},"address":"http://192.168.1.2:2869/","upnpVersion":"1.0","serialNumber":"S-1-5-21-3493001740-195389577-1747714056-1001","type":{"urn":"urn:schemas-upnp-org:device:MediaServer:1","name":"Media Server 1"},"name":"TOSHIBA: PJ:","manufacturer":{"name":"Microsoft Corporation","url":"http://www.microsoft.com"},"model":{"number":12,"name":"Windows Media Player Sharing","url":"http://go.microsoft.com/fwlink/?LinkId=105926","udn":"uuid:41cf7512-c290-4bff-82bf-962e4cab1c26"},"icons":[{"mimeType":"image/jpeg","width":120,"height":120,"depth":24,"url":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:6571a80c-b099-4ef1-bff1-f632e6d00a42"},{"mimeType":"image/png","width":120,"height":120,"depth":24,"url":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:0a332791-2b2f-4eb5-b2e4-484a067fe6ad"},{"mimeType":"image/jpeg","width":48,"height":48,"depth":24,"url":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:fe67aac6-d76b-4a9b-a80a-8a3a21a1df52"},{"mimeType":"image/png","width":48,"height":48,"depth":24,"url":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:52a7e157-ccae-4e53-afe9-296d070682aa"},{"mimeType":"image/bmp","width":48,"height":48,"depth":16,"url":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:ab2b28a7-b393-40c5-aa24-e90c30cd1e75"},{"mimeType":"image/jpeg","width":32,"height":32,"depth":24,"url":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:70695fe5-5ca5-4caa-aa5c-8e8dd95979d4"},{"mimeType":"image/bmp","width":32,"height":32,"depth":16,"url":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:ba118676-7928-45aa-abf4-75cd2a0d9540"}],"services":[{"controlUrl":"http://192.168.1.2:2869/upnphost/udhisapi.dll?control=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:upnp-org:serviceId:ConnectionManager","eventsSubUrl":null,"scpdUrl":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:ea27425e-13a7-4c9e-ab1a-70228afb3dee","id":"urn:upnp-org:serviceId:ConnectionManager","type":{"urn":"urn:schemas-upnp-org:service:ConnectionManager:1","name":"Connection Manager 1"}},{"controlUrl":"http://192.168.1.2:2869/upnphost/udhisapi.dll?control=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:upnp-org:serviceId:ContentDirectory","eventsSubUrl":null,"scpdUrl":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:51077243-1d70-4741-8a2e-8d9056ae7d59","id":"urn:upnp-org:serviceId:ContentDirectory","type":{"urn":"urn:schemas-upnp-org:service:ContentDirectory:1","name":"Content Directory 1"}},{"controlUrl":"http://192.168.1.2:2869/upnphost/udhisapi.dll?control=uuid:41cf7512-c290-4bff-82bf-962e4cab1c26+urn:microsoft.com:serviceId:X_MS_MediaReceiverRegistrar","eventsSubUrl":null,"scpdUrl":"http://192.168.1.2:2869/upnphost/udhisapi.dll?content=uuid:f95ddc12-eb3f-4dfb-b5a1-a310ce477525","id":"urn:microsoft.com:serviceId:X_MS_MediaReceiverRegistrar","type":{"urn":"urn:microsoft.com:service:X_MS_MediaReceiverRegistrar:1","name":"Media Receiver Registrar"}}]},{"_emitter":{"EVENT_TYPE_PATTERN":{}},"mirrorCapable":true,"audioCapable":true,"videoCapable":true,"rawResponse":{"specversion":{"major":1,"minor":0},"urlbase":"http://192.168.1.12:8008","device":{"devicetype":"urn:dial-multiscreen-org:device:dial:1","friendlyname":"VizioCast","manufacturer":"Google Inc.","modelname":"Eureka Dongle","udn":"uuid:c00cf3eb-2fcd-5a7b-00c9-c6cfedc1bfcc","iconlist":{"icon":{"mimetype":"image/png","width":98,"height":55,"depth":32,"url":"/setup/icon.png"}},"servicelist":{"service":{"servicetype":"urn:dial-multiscreen-org:service:dial:1","serviceid":"urn:dial-multiscreen-org:serviceId:dial","controlurl":"/ssdp/notfound","eventsuburl":"/ssdp/notfound","scpdurl":"/ssdp/notfound"}}},"@xmlns":"urn:schemas-upnp-org:device-1-0"},"address":"http://192.168.1.12:8008/","upnpVersion":"1.0","type":{"urn":"urn:dial-multiscreen-org:device:dial:1","name":"DIAL Multiscreen"},"name":"VizioCast","manufacturer":{"name":"Google Inc."},"model":{"name":"Eureka Dongle","udn":"uuid:c00cf3eb-2fcd-5a7b-00c9-c6cfedc1bfcc"},"icons":[{"mimeType":"image/png","width":98,"height":55,"depth":32,"url":"http://192.168.1.12:8008/setup/icon.png"}],"services":[{"controlUrl":null,"eventsSubUrl":null,"scpdUrl":null,"id":"urn:dial-multiscreen-org:serviceId:dial","type":{"urn":"urn:dial-multiscreen-org:service:dial:1","name":"DIAL Multiscreen"}}]},{"_messageFactory":{"_transporterFactory":{}},"_messenger":{"_transporter":{"_transportService":{},"_scriptableInputStream":{},"_inputStreamPump":{"name":"","status":0,"loadGroup":null,"loadFlags":0,"LOAD_REQUESTMASK":65535,"LOAD_NORMAL":0,"LOAD_BACKGROUND":1,"INHIBIT_PIPELINE":64,"INHIBIT_CACHING":128,"INHIBIT_PERSISTENT_CACHING":256,"LOAD_BYPASS_CACHE":512,"LOAD_FROM_CACHE":1024,"VALIDATE_ALWAYS":2048,"VALIDATE_NEVER":4096,"VALIDATE_ONCE_PER_SESSION":8192,"LOAD_ANONYMOUS":16384,"LOAD_FRESH_CONNECTION":32768},"_emitter":{"EVENT_TYPE_PATTERN":{}},"_transport":{},"_outputStream":{},"_inputStream":{}},"_emitter":{"EVENT_TYPE_PATTERN":{}},"_timers":{}},"_emitter":{"EVENT_TYPE_PATTERN":{}},"mirrorCapable":true,"audioCapable":true,"videoCapable":true,"rawResponse":{"specversion":{"major":1,"minor":0},"urlbase":"http://192.168.1.13:9431","device":{"devicetype":"urn:dial-multiscreen-org:device:dial:1","friendlyname":"Sticky","manufacturer":"openflint","modelname":"MatchStick","udn":"uuid:1d298d40-8fc1-11e4-b28e-cb72e50b79a3","iconlist":{"icon":{"mimetype":"image/png","width":98,"height":55,"depth":32,"url":"/setup/icon.png"}},"servicelist":{"service":{"servicetype":"urn:dial-multiscreen-org:service:dial:1","serviceid":"urn:dial-multiscreen-org:serviceId:dial","controlurl":"/ssdp/notfound","eventsuburl":"/ssdp/notfound","scpdurl":"/ssdp/notfound"}}},"@xmlns":"urn:schemas-upnp-org:device-1-0"},"address":"http://192.168.1.13:9431/","upnpVersion":"1.0","type":{"urn":"urn:dial-multiscreen-org:device:dial:1","name":"DIAL Multiscreen"},"name":"Sticky","manufacturer":{"name":"openflint"},"model":{"name":"MatchStick","udn":"uuid:1d298d40-8fc1-11e4-b28e-cb72e50b79a3"},"icons":[{"mimeType":"image/png","width":98,"height":55,"depth":32,"url":"http://192.168.1.13:9431/setup/icon.png"}],"services":[{"controlUrl":null,"eventsSubUrl":null,"scpdUrl":null,"id":"urn:dial-multiscreen-org:serviceId:dial","type":{"urn":"urn:dial-multiscreen-org:service:dial:1","name":"DIAL Multiscreen"}}],"langauge":"en-US","macAddress":"98:3b:16:e9:47:70","timezone":"America/Chicago","softwareVersion":"MATCHSTICK-KK.201412300904"}]');












